#!/bin/bash

# PHP_UNIT_BIN can be set in .env to determine location of PHP Unit launch script
# "/app/artisan test" or "vendor/bin/phpunit"
if [ -z "$PHP_UNIT_BIN" ]; then
  PHP_UNIT_BIN="vendor/bin/phpunit"
fi

if [ -f "/app/config/phpunit.xml" ]; then
  CONFIG="/app/config/phpunit.xml"
elif [ -f "/app/vendor/elph-studio/laravel-testing-tools/src/Config/phpunit.xml" ]; then
  CONFIG="/app/vendor/elph-studio/laravel-testing-tools/src/Config/phpunit.xml"
elif [ -f "/app/src/Config/phpunit.xml" ]; then
  CONFIG="/app/src/Config/phpunit.xml"
else
  echo "ERROR: PHP Unit config not found."

  return 255
fi

PHP_UNIT_BIN=$(echo $PHP_UNIT_BIN|tr -d '\n')

if [ -z "$1" ]; then
  php $PHP_UNIT_BIN --config="$CONFIG"
elif [ -z "$2" ] && [[ $1 =~ ^-* ]]; then
  php $PHP_UNIT_BIN --config="$CONFIG" --filter "${1}"
else
  php $PHP_UNIT_BIN --config="$CONFIG" "${@}"
fi
