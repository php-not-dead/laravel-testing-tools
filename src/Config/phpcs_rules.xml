<?xml version="1.0"?>
<ruleset>
    <rule ref="OpaySniffs"/>

    <!-- Include rule excluded by OpaySniffs and fix it with VendorFixer -->
    <rule ref="PSR1.Files.SideEffects.FoundWithSymbols">
        <severity>5</severity>
    </rule>

    <!-- Allow empty catch statements -->
    <rule ref="Generic.CodeAnalysis.EmptyStatement.DetectedCatch">
        <severity>0</severity>
    </rule>

    <rule ref="OpaySniffs.Classes.NonExistingUses">
        <properties>
            <property name="ignoreGlobalNamespaces" type="array">
                <element value="OpenApi"/>
                <element value="JetBrains"/>
            </property>
        </properties>
    </rule>

    <rule ref="OpaySniffs.Classes.ForbiddenClasses">
        <properties>
            <property name="forbiddenExtends" type="array">
                <element key="Illuminate\Database\Eloquent\Model" value="Elph\LaravelDatabase\Model\Model"/>
                <element key="Illuminate\Database\Eloquent\Factories\Factory" value="Elph\LaravelDatabase\Database\Faker"/>
                <element key="Illuminate\Database\Seeder" value="Elph\LaravelDatabase\Database\Seeder"/>
                <element key="Illuminate\Database\Migrations\Migration" value="Elph\LaravelDatabase\Migration\Migration"/>
                <element key="Illuminate\Database\Schema\Blueprint" value="Elph\LaravelDatabase\Migration\Blueprint"/>
                <!-- Collections usage by mistake -->
                <element key="Nwidart\Modules\Collection" value="Illuminate\Support\Collection"/>
                <element key="Ramsey\Collection\Collection" value="Illuminate\Support\Collection"/>
                <element key="Spiral\RoadRunner\Console\Repository\Collection" value="Illuminate\Support\Collection"/>
                <element key="Cassandra\Collection" value="Illuminate\Support\Collection"/>
                <element key="Couchbase\Collection" value="Illuminate\Support\Collection"/>
                <element key="mysql_xdevapi\Collection" value="Illuminate\Support\Collection"/>
                <element key="Cassandra\Type\Collection" value="Illuminate\Support\Collection"/>
                <!-- One of -->
                <element key="Illuminate\Foundation\Testing\TestCase" value="Elph\LaravelTesting\Test\TestCase\UnitTestCase,
                    Elph\LaravelTesting\Test\TestCase\IntegrationTestCase,
                    Elph\LaravelTesting\Test\TestCase\FeatureTestCase
                "/>
                <element key="Test\TestCase" value="Elph\LaravelTesting\Test\TestCase\UnitTestCase,
                    Elph\LaravelTesting\Test\TestCase\IntegrationTestCase,
                    Elph\LaravelTesting\Test\TestCase\FeatureTestCase
                "/>
            </property>
        </properties>
        <exclude-pattern>src/Model/Model.php</exclude-pattern>
        <exclude-pattern>src/Faker/Faker.php</exclude-pattern>
        <exclude-pattern>src/Seeder/Seeder.php</exclude-pattern>
        <exclude-pattern>src/Migration/Migration.php</exclude-pattern>
        <exclude-pattern>*TestCase.php</exclude-pattern>
    </rule>

    <rule ref="Generic.PHP.ForbiddenFunctions">
        <properties>
            <property name="forbiddenFunctions" type="array">
                <element key="sizeof" value="count"/>
                <element key="print" value="echo"/>
                <!-- Replace plain PHP with Laravel functions-->
                <element key="is_dir" value="File::isDirectory"/>
                <element key="file_exists" value="File::exists"/>
                <element key="foreach" value="collect()->each(), collect()->map(), collect()->filter() and other collect()->..."/>
                <element key="array_filter" value="collect()->filter"/>
                <element key="array_merge" value="collect()->merge"/>
                <element key="array_keys" value="collect()->keys"/>
                <element key="array_key_exists" value="Arr::has"/>
                <element key="array_search" value="collect()->search"/>
                <element key="in_array" value="collect()->contains"/>
                <element key="explode" value="Str::of(...)->explode"/>
                <!-- Disallow some Laravel functions-->
                <element key="throw_if" value="if (...) { throw new ...Exception(...); }"/>
                <element key="throw_unless" value="if (...) { throw new ...Exception(...); }"/>
            </property>
        </properties>
        <exclude-pattern>*Test.php</exclude-pattern>
        <exclude-pattern>*Module/Config/*.php</exclude-pattern>
        <exclude-pattern>*config/*.php</exclude-pattern>
    </rule>

    <rule ref="SlevomatCodingStandard.Functions.StaticClosure">
        <exclude-pattern>*Database/Factory/*$</exclude-pattern>
    </rule>

    <rule ref="Generic.NamingConventions.CamelCapsFunctionName">
        <exclude-pattern>*/*Helper*.php$</exclude-pattern>
    </rule>

    <rule ref="Generic.CodeAnalysis.UnusedFunctionParameter">
        <exclude-pattern>src/Entity/*.php$</exclude-pattern>
        <exclude-pattern>src/Exception/Handler.php$</exclude-pattern>
        <exclude-pattern>src/DataTransferObject/*.php$</exclude-pattern>
        <exclude-pattern>src/ValidationRule/*.php$</exclude-pattern>
    </rule>

    <rule ref="Generic.Files.LineLength">
        <exclude-pattern>*Message.php</exclude-pattern>
        <exclude-pattern>*CacheKey.php</exclude-pattern>
        <exclude-pattern>*CacheTag.php</exclude-pattern>
    </rule>

</ruleset>
